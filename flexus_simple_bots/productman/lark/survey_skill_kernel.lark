def _find_message(messages, content, role):
    for m in messages:
        if role != None:
            if m["role"] == role and content in str(m["content"]):
                return m
        else:
            if content in str(m["content"]):
                return m
    return None


warning_text = "ðŸ’¿ Cannot close the task until survey campaign is completed"
has_campaign_completed = _find_message(messages, "ompleted", None) != None
has_survey_launched = _find_message(messages, "campaign launched successfully", None) != None

if has_survey_launched and not has_campaign_completed:
    last_assistant_msg = None
    for m in messages[::-1]:
        if m.get("role") == "assistant":
            last_assistant_msg = m
            break
    if last_assistant_msg:
        for t in last_assistant_msg.get("tool_calls", []):
            if t.get("function", {}).get("name") == "flexus_bot_kanban":
                args = t.get("function", {}).get("arguments", "")
                if "current_task_done" in args:
                    post_cd_instruction = warning_text
                    break
